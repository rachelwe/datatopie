let datas=[];let header=[];const svgTable=document.querySelector("[data-graph-table]");function tableToJson(e){header={x:e.rows[0].cells[0].innerHTML,y:e.rows[0].cells[1].innerHTML};for(var t=1;t<e.rows.length;t++){var a=e.rows[t];var s={x:a.cells[0].innerHTML,y:a.cells[1].innerHTML};datas.push(s)}}tableToJson(svgTable);let config={titleY:header.y,titleX:header.x,labelsSizeY:55,labelsSizeX:120,scaleY:150,scaleX:50,startGraph:65,endGraph:0,offsetY:35};const template=`\n  <title id="title">A very simple line chart about income</title>\n  <g class="graph_grid graph_grid--x" id="xGrid" data-grid="x"></g>\n  <g class="graph_grid graph_grid--y" id="yGrid" data-grid="y"></g>\n  <g class="graph_labels graph_labels--x" data-labels="x"></g>\n  <g class="graph_labels graph_labels--y" data-labels="y"></g>\n  <g class="graph_data" data-datas>\n    <polyline data-line points="" />\n  </g>\n  `;const svgns="http://www.w3.org/2000/svg";const svgGraph=document.querySelector("[data-graph]");const svgGraphInner=svgGraph.querySelector("svg");const tooltips=svgGraph.querySelector("[data-tooltips]");const toggle=svgGraph.querySelector("[data-graph-toggle]");let svgDatasWrapper;let svgLine;let svgLabelsX;let svgLabelsY;let svgGridX;let svgGridY;let points="";let percentages=[];let values=[];datas.forEach((e=>{values.push(e.y)}));let maxValue=Math.max(...values);function generateRelativePosition(){values.forEach((e=>{percentages.push(e/maxValue*config.scaleY)}))}function setPoints(){percentages.forEach(((e,t)=>{const a={x:config.startGraph+t*config.scaleX,y:config.offsetY+(config.scaleY-e)};points+=a.x+", "+a.y+" ";svgLine.setAttributeNS(null,"points",points);const s=document.createElementNS(svgns,"circle");setAttributesNS(s,[{cx:a.x},{cy:a.y},{r:4},{tabindex:0},{role:"img"},{"aria-labelledby":"graph_tooltip"+t},{"data-value":values[t]}]);svgDatasWrapper.appendChild(s);const n=document.createElementNS(svgns,"text");setAttributesNS(n,[{x:a.x},{y:config.offsetY+config.scaleY+20},{transform:"rotate(-45, "+a.x+", "+(config.offsetY+config.scaleY+20)+")"}]);n.textContent=datas[t].x;svgLabelsX.appendChild(n);const r=document.createElement("div");r.setAttribute("style",`left: ${a.x-15}px; top: ${a.y-65}px`);r.setAttribute("class","graph_tooltip");r.setAttribute("id","graph_tooltip"+t);r.innerHTML=`\n      <p>${datas[t].x}</p>\n      <p>${datas[t].y} â‚¬</p>\n    `;tooltips.appendChild(r);if(t=percentages.length-1){config.endGraph=a.x;setAttributesNS(svgLine,[{"stroke-dasharray":svgLine.getTotalLength()},{"stroke-dashoffset":svgLine.getTotalLength()},{style:"--stroke-size: "+svgLine.getTotalLength()}])}}))}function setLegend(){const e=document.createElementNS(svgns,"line");setAttributesNS(e,[{x1:config.startGraph},{x2:config.startGraph},{y1:config.offsetY},{y2:config.offsetY+config.scaleY}]);svgGridX.appendChild(e);const t=document.createElementNS(svgns,"text");setAttributesNS(t,[{x:config.endGraph/2+config.startGraph/2},{y:config.scaleY+config.labelsSizeX+config.offsetY/2},{class:"label-title"}]);t.textContent=config.titleX;svgLabelsX.appendChild(t);let a=calculateTicks(0,maxValue,6);let s=[];a.forEach((e=>{s.push(e/maxValue*config.scaleY)}));s.forEach(((e,t)=>{const s=e;const n=document.createElementNS(svgns,"text");setAttributesNS(n,[{x:config.startGraph-10},{y:config.offsetY+(config.scaleY-s)}]);n.textContent=a[t];svgLabelsY.appendChild(n);const r=document.createElementNS(svgns,"line");setAttributesNS(r,[{x1:config.startGraph},{x2:config.endGraph},{y1:config.offsetY+(config.scaleY-s)},{y2:config.offsetY+(config.scaleY-s)}]);svgGridY.appendChild(r)}));const n=document.createElementNS(svgns,"text");setAttributesNS(n,[{x:config.startGraph-10},{y:config.offsetY/2},{class:"label-title"}]);n.textContent=config.titleY;svgLabelsY.appendChild(n)}function setGraphSize(){const e=config.endGraph+10;const t=config.scaleY+config.labelsSizeX+config.offsetY;setAttributesNS(svgGraphInner,[{viewBox:"0 0 "+e+" "+t},{width:e},{height:t}]);svgGraph.style.setProperty("--graph-width",e+"px")}function drawGraph(){points=0;percentages=[];svgGraphInner.innerHTML=template;tooltips.innerHTML="";svgDatasWrapper=svgGraph.querySelector("[data-datas]");svgLine=svgGraph.querySelector("[data-line]");svgLabelsX=svgGraph.querySelector('[data-labels="x"]');svgLabelsY=svgGraph.querySelector('[data-labels="y"]');svgGridX=svgGraph.querySelector('[data-grid="x"]');svgGridY=svgGraph.querySelector('[data-grid="y"]');if(window.matchMedia(`(max-width: 400px)`).matches){config.scaleX=20;config.scaleY=60}else if(window.matchMedia(`(max-width: 700px) and (min-width: 401px)`).matches){config.scaleX=35;config.scaleY=100}else{config.scaleX=50;config.scaleY=150}generateRelativePosition();setPoints();setLegend();setGraphSize()}window.addEventListener("DOMContentLoaded",drawGraph);window.addEventListener("resize",debounce(drawGraph,200));["mouseenter","focus"].forEach((e=>{svgGraphInner.addEventListener(e,(t=>{if(e=="focus")t.target.classList.add("is-focused");if(t.target.matches("circle")){const e=t.target.getAttribute("aria-labelledby");const a=document.getElementById(e);a.classList.add("is-active")}}),true)}));["mouseleave","blur"].forEach((e=>{svgGraphInner.addEventListener(e,(t=>{if(e=="blur")t.target.classList.remove("is-focused");if(t.target.matches("circle")){const e=t.target.getAttribute("aria-labelledby");const a=document.getElementById(e);if(!t.target.classList.contains("is-focused")){a.classList.remove("is-active")}}}),true)}));toggle.addEventListener("click",(()=>{const e=document.querySelectorAll("[data-toggle-state]");e.forEach((e=>{const t=e.getAttribute("data-toggle-state");let a=e.getAttribute("data-toggle-name");if(t=="true"){toggle.innerHTML="affichage "+a}e.setAttribute("data-toggle-state",t=="true"?false:true)}))}));function debounce(e,t,a){var s;return function(){var n=this,r=arguments;var i=function(){s=null;if(!a)e.apply(n,r)};var l=a&&!s;clearTimeout(s);s=setTimeout(i,t);if(l)e.apply(n,r)}}var setAttributesNS=function(e,t){t.forEach((function(t){t=Object.entries(t)[0];e.setAttributeNS(null,t[0],t[1])}))};function calculateTicks(e,t,a){var s=t-e,n=Math.pow(10,Math.floor(Math.log(s/a)/Math.LN10)),r=a/s*n;if(r<=.15)n*=10;else if(r<=.35)n*=5;else if(r<=.75)n*=2;var l=Math.ceil(e/n)*n,o=Math.floor(t/n)*n+n*.5,c=[];for(i=l;i<o;i+=n){c.push(i)}return c}